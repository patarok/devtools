#!/bin/sh

showHelp() {
cat << EOF  
Usage: remote-to-remote --source <user@host> --target <user@host> [-h]
Syncs all files from source to target ispconfig webhost
EOF
}

export source=0
export target=0

# $@ is all command line parameters passed to the script.
# -o is for short options like -v
# -l is for long options with double dash like --version
# the comma separates different long options
# -a is for long options with single dash like -version
options=$(getopt -l "help,source:,target:" -o "h" -a -- "$@")

# set --:
# If no arguments follow this option, then the positional parameters are unset. Otherwise, the positional parameters 
# are set to the arguments, even if some of them begin with a ‘-’.
eval set -- "$options"

while true
do
case $1 in
-h|--help) 
    showHelp
    exit 0
    ;;
-s|--source) 
    shift
    export source=$1
    ;;
-t|--target)
    shift
    export target=$1
    ;;
--)
    shift
    break;;
esac
shift
done


if [[ "$source" == "0" ]]; then
    echo "Source must be given!"
    showHelp
    exit 1
fi

if [[ "$target" == "0" ]]; then
    echo "Target must be given!"
    showHelp
    exit 1
fi

ssh -At $source "rsync -rlzhtv --exclude '.env' $@ ../../web/ $target:../../web/"